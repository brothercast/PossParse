<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>AI-Filled Research Modal</title>  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">  
    <link href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator.min.css" rel="stylesheet">  
    <style>  
        /* Modal Custom Styling */  
        .modal-header-text {  
            text-transform: uppercase;  
            font-family: 'Unica One', sans-serif;  
            font-weight: 500;  
            font-size: 1.5em;  
            text-shadow: 1px 1px 0px #000000;  
            color: #ffffff;  
        }  
        .modal-content {  
            border-radius: 10px;  
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);  
            border: 2px solid transparent; /* Default border to avoid collapse */  
        }  
        .modal-header {  
            border-top-left-radius: 10px;  
            border-top-right-radius: 10px;  
            position: relative;  
            padding: 1rem;  
            background-color: var(--phase-color, #e91e63); /* Default color */  
        }  
        .node-icon {  
            background-color: white;  
            border-radius: 5px;  
            padding: 10px;  
            margin-right: 0.5rem;  
        }  
        .modal-body {  
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);  
        }  
        .btn-save-changes {  
            background-color: var(--bs-primary);  
            border-color: var(--bs-primary);  
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  
        }  
        .btn-save-changes:hover {  
            background-color: var(--bs-primary);  
            border-color: var(--bs-primary);  
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);  
        }  
        .modal-header .filled-box {  
            position: absolute;  
            top: 0;  
            left: 0;  
            right: 0;  
            bottom: 0;  
            background-color: var(--phase-color, #e91e63); /* Default color */  
            z-index: -1;  
        }  
        .modal-title {  
            font-family: 'Unica One', sans-serif;  
            font-weight: 500;  
            text-transform: uppercase;  
            text-shadow: 1px 1px 0px #000000;  
            color: white;  
        }  
        .phase-colors {  
            --phase-0: #e91e63;  
            --phase-1: #00bcd4;  
            --phase-2: #9c27b0;  
            --phase-3: #ffc107;  
            --phase-4: #66bd0e;  
        }  
        [data-phase-index="0"] .modal-header .filled-box,  
        [data-phase-index="0"] .modal-header {  
            background-color: var(--phase-0) !important;  
        }  
        [data-phase-index="1"] .modal-header .filled-box,  
        [data-phase-index="1"] .modal-header {  
            background-color: var(--phase-1) !important;  
        }  
        [data-phase-index="2"] .modal-header .filled-box,  
        [data-phase-index="2"] .modal-header {  
            background-color: var(--phase-2) !important;  
        }  
        [data-phase-index="3"] .modal-header .filled-box,  
        [data-phase-index="3"] .modal-header {  
            background-color: var(--phase-3) !important;  
        }  
        [data-phase-index="4"] .modal-header .filled-box,  
        [data-phase-index="4"] .modal-header {  
            background-color: var(--phase-4) !important;  
        }  
        [data-phase-index="0"] .modal-content {  
            border: 2px solid var(--phase-0) !important;  
        }  
        [data-phase-index="1"] .modal-content {  
            border: 2px solid var(--phase-1) !important;  
        }  
        [data-phase-index="2"] .modal-content {  
            border: 2px solid var(--phase-2) !important;  
        }  
        [data-phase-index="3"] .modal-content {  
            border: 2px solid var(--phase-3) !important;  
        }  
        [data-phase-index="4"] .modal-content {  
            border: 2px solid var(--phase-4) !important;  
        }  
    </style>  
</head>  
<body>  
    <!-- Modal Trigger Button -->  
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ceModal">  
        Open Modal  
    </button>  
  
    <!-- Modal Dialog -->  
    <div class="modal fade" id="ceModal" tabindex="-1" aria-labelledby="ceModalLabel" aria-hidden="true" data-phase-index="0">  
        <div class="modal-dialog modal-lg" role="document">  
            <div class="modal-content">  
                <div class="modal-header">  
                    <div class="filled-box"></div>  
                    <h5 class="modal-title" id="ceModalLabel">  
                        <span class="node-icon">  
                            <i class="fa fa-flask"></i>  
                        </span>  
                        <span class="modal-header-title">Research</span>  
                    </h5>  
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>  
                </div>  
                <div class="modal-body">  
                    <p id="aiContext">This node aggregates resources and research related to the Conditional Element.</p>  
                    <h6>Parent COS: Example COS Content</h6>  
                    <form id="ceForm">  
                        <div class="form-group">  
                            <label for="research_topic">Research Topic</label>  
                            <input type="text" class="form-control" id="research_topic" name="research_topic" placeholder="Research Topic">  
                        </div>  
                        <div class="form-group">  
                            <label for="research_summary">Research Summary</label>  
                            <textarea class="form-control" id="research_summary" name="research_summary" rows="3" placeholder="Research Summary"></textarea>  
                        </div>  
                        <div class="form-group">  
                            <label for="researcher_name">Researcher Name</label>  
                            <input type="text" class="form-control" id="researcher_name" name="researcher_name" placeholder="Researcher Name">  
                        </div>  
                    </form>  
                </div>  
                <div class="modal-footer">  
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>  
                    <button type="button" class="btn btn-primary btn-save-changes">Save changes</button>  
                </div>  
            </div>  
        </div>  
    </div>  
  
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>  
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>  
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>  
    <script>  
        $(document).ready(function () {  
            $('#ceModal').on('show.bs.modal', function () {  
                // Fetch AI data and fill in the fields  
                fetchAIData();  
            });  
  
            function fetchAIData() {  
                const requestData = {  
                    ce_id: 'example_ce_id',  
                    cos_content: 'Example COS Content',  
                    phase_name: 'Discovery',  
                    phase_index: 0,  
                    ssol_goal: 'Example Goal',  
                    ce_type: 'Research'  
                };  
  
                $.ajax({  
                    url: '/get_ce_modal/Research',  
                    type: 'POST',  
                    contentType: 'application/json',  
                    data: JSON.stringify(requestData),  
                    success: function (response) {  
                        if (response.success) {  
                            // Fill in the AI context and form fields  
                            $('#aiContext').text(response.ai_data.summary);  
                            $('#research_topic').val(response.ai_data.fields.research_topic);  
                            $('#research_summary').val(response.ai_data.fields.research_summary);  
                            $('#researcher_name').val(response.ai_data.fields.researcher_name);  
                        } else {  
                            alert('Error fetching AI suggestions');  
                        }  
                    },  
                    error: function (xhr, status, error) {  
                        console.error('Error fetching AI suggestions:', error);  
                    }  
                });  
            }  
  
            // Save changes button click event  
            $('.btn-save-changes').on('click', function () {  
                const formData = $('#ceForm').serializeArray();  
                console.log('Form Data:', formData);  
                $('#ceModal').modal('hide');  
            });  
        });  
    </script>  
</body>  
</html>  
